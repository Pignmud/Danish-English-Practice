<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Danish-English Dictionary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    :root {
      --bg: #f4f4f4;
      --text: #333;
      --accent: #0055a5;
      --card: #fff;
    }
    body.dark {
      --bg: #1e1e1e;
      --text: #eee;
      --accent: #66ccff;
      --card: #2c2c2c;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 2em;
      background-color: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    h1 {
      color: var(--accent);
      font-size: 1.8em;
      margin-bottom: 0.5em;
    }
    input, select, button {
      width: 100%;
      padding: 0.6em;
      font-size: 1em;
      margin-bottom: 1em;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: var(--card);
      color: var(--text);
    }
    #results, #quiz {
      background-color: var(--card);
      padding: 1em;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 1em;
    }
    .result, .quiz-question {
      margin-bottom: 1em;
    }
    .highlight {
      background-color: yellow;
    }
    .controls {
      display: flex;
      gap: 0.5em;
      flex-wrap: wrap;
      margin-top: 0.5em;
    }
    button.audio, button.copy {
      flex: 1;
      padding: 0.3em 0.6em;
      font-size: 0.9em;
      cursor: pointer;
    }
    #history {
      margin-top: 1em;
    }
    #history span {
      display: inline-block;
      background: var(--card);
      border: 1px solid #ccc;
      padding: 0.3em 0.6em;
      margin: 0.2em;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Danish-English Dictionary</h1>
  <button onclick="toggleDarkMode()">üåô Toggle Dark Mode</button>
  <select id="searchMode">
    <option value="both">Search: Danish + English</option>
    <option value="danish">Search: Danish only</option>
    <option value="english">Search: English only</option>
  </select>
  <input type="text" id="searchInput" placeholder="Type a word..." />
  <button onclick="showRandom()">üé≤ Random Word</button>
  <button onclick="startQuiz()">üéì Start Quiz</button>
  <div id="results"></div>
  <div id="quiz"></div>
<button id="retakeQuizBtn" onclick="startQuiz()" style="display:none;">üîÅ Retake Quiz</button>
  <div id="history"></div>

  <script>
    let examples = [];

    fetch("danish_english_pairs.json")
      .then(res => res.json())
      .then(data => {
        examples = data;
        loadHistory();
      })
      .catch(err => {
        console.error("Fetch error:", err);
        document.getElementById("results").innerHTML = "<p style='color:red;'>Failed to load JSON.</p>";
      });

    document.getElementById("searchInput").addEventListener("input", handleSearch);

    function handleSearch() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      if (query.length === 0) {
        document.getElementById("results").innerHTML = "";
        return;
      }
      saveToHistory(query);
      const mode = document.getElementById("searchMode").value;
      const threshold = 3;

      const matches = examples.filter(pair => {
        const danish = pair.Danish.toLowerCase();
        const english = pair.English.toLowerCase();

        if (mode === "danish") {
          return danish.includes(query) || levenshtein(danish, query) <= threshold;
        }
        if (mode === "english") {
          return english.includes(query) || levenshtein(english, query) <= threshold;
        }
        return (
          danish.includes(query) || english.includes(query) ||
          levenshtein(danish, query) <= threshold ||
          levenshtein(english, query) <= threshold
        );
      });

      document.getElementById("results").innerHTML = matches.map(pair =>
        `<div class="result">
          <strong>Danish:</strong> ${highlight(pair.Danish, query)}<br>
          <strong>English:</strong> ${highlight(pair.English, query)}
          <div class="controls">
            <button class="audio" onclick="speakDanish('${pair.Danish.replace(/'/g, "\\'")}')">üîä Hear Danish</button>
            <button class="copy" onclick="copyToClipboard('${pair.Danish} ‚Äî ${pair.English}')">üìã Copy</button>
          </div>
        </div>`
      ).join("");
    }

    function showRandom() {
      if (examples.length === 0) return;
      const pair = examples[Math.floor(Math.random() * examples.length)];
      document.getElementById("searchInput").value = "";
      document.getElementById("results").innerHTML = `
        <div class="result">
          <strong>Danish:</strong> ${pair.Danish}<br>
          <strong>English:</strong> ${pair.English}
          <div class="controls">
            <button class="audio" onclick="speakDanish('${pair.Danish.replace(/'/g, "\\'")}')">üîä Hear Danish</button>
            <button class="copy" onclick="copyToClipboard('${pair.Danish} ‚Äî ${pair.English}')">üìã Copy</button>
          </div>
        </div>
      `;
    }

function startQuiz() {
  if (examples.length < 5) {
    document.getElementById("quiz").innerHTML = "<p>Not enough data for a quiz.</p>";
    document.getElementById("retakeQuizBtn").style.display = "none";
    return;
  }

  const shuffled = [...examples].sort(() => 0.5 - Math.random()).slice(0, 5);
  const quizHTML = shuffled.map((pair, i) => {
    const correct = pair.English;
    const options = [correct];
    while (options.length < 4) {
      const alt = examples[Math.floor(Math.random() * examples.length)].English;
      if (!options.includes(alt)) options.push(alt);
    }
    options.sort(() => 0.5 - Math.random());

    return `
      <div class="quiz-question">
        <p><strong>Q${i + 1}:</strong> What is the English meaning of "<em>${pair.Danish}</em>"?</p>
        ${options.map(opt => `
          <button onclick="checkAnswer(this, '${opt}', '${correct}')">${opt}</button>
        `).join("")}
      </div>
    `;
  }).join("");

  document.getElementById("quiz").innerHTML = `<h3>Quiz Mode</h3>${quizHTML}`;
  document.getElementById("retakeQuizBtn").style.display = "block";
}

    function checkAnswer(button, selected, correct) {
      const buttons = button.parentElement.querySelectorAll("button");
      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === correct) {
          btn.style.backgroundColor = "#c8e6c9"; // green
        }
      });
      if (selected !== correct) {
        button.style.backgroundColor = "#ffcdd2"; // red
      }
    }

    function highlight(text, query) {
      const regex = new RegExp(`(${query})`, "gi");
      return text.replace(regex, "<span class='highlight'>$1</span>");
    }

    function speakDanish(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "da-DK";
      speechSynthesis.speak(utterance);
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert("Copied to clipboard!");
      });
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

    function saveToHistory(query) {
      let history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      if (!history.includes(query)) {
        history.unshift(query);
        if (history.length > 10) history.pop();
        localStorage.setItem("searchHistory", JSON.stringify(history));
        loadHistory();
      }
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      const container = document.getElement
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
      const container = document.getElementById("history");
      if (history.length === 0) {
        container.innerHTML = "";
        return;
      }
      container.innerHTML = "<h3>Recent Searches</h3>" + history.map(q =>
        `<span onclick="searchFromHistory('${q}')">${q}</span>`
      ).join("");
    }

    function searchFromHistory(query) {
      document.getElementById("searchInput").value = query;
      handleSearch();
    }

    function levenshtein(a, b) {
      const matrix = Array.from({ length: b.length + 1 }, (_, i) => [i]);
      for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          const cost = b[i - 1] === a[j - 1] ? 0 : 1;
          matrix[i][j] = Math.min(
            matrix[i - 1][j] + 1,
            matrix[i][j - 1] + 1,
            matrix[i - 1][j - 1] + cost
          );
        }
      }
      return matrix[b.length][a.length];
    }
  </script>
</body>
</html>